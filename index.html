<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Geographic Vectors: Wind Turbines</title>
    <!--Load d3.js-->
    <script src="https://d3js.org/d3.v6.js"></script>
    <script src="https://d3js.org/d3-geo-projection.v3.min.js"></script>
    <style>
        path:hover {
            fill-opacity: 0.8;
        }

        body {
            font: 11px sans-serif;
        }

        /* Style for Custom Tooltip */
        div.tooltip {
            position: absolute;
            text-align: center;
            display: inline-block;
            padding: 2px;
            font: 12px sans-serif;
            background: white;
            border: 0px;
            border-radius: 8px;
            pointer-events: none;
        }

        header {
            font-style: sans-serif;
            font-size: medium
        }

        body {
            background-color: #f5f5f5;
        }

        .legend {
            position: absolute;
            left: 950px;
            top: 725px;
        }
    </style>
    <br>
    <br>
    <header style="text-align: center;">Hypothesis: There are larger numbers of wind turbine farms around state capitals
        compared to the rest of the United States.</header>
    <header style="text-align: center;">Source for Wind Turbines: <a
            href="https://www.kaggle.com/datasets/txtrouble/wind-farms?resource=download">Wind-farms</a> Source for US
        Geojson: <a href="https://eric.clst.org/tech/usgeojson/">US Geojson</a></header>
</head>

<body>
    <br>
    <br>
    <hr>
    <br>
    <div id = "Origin" style="text-align: center;">
        <svg id="USA" width="1000" height="1000"></svg>
    </div>
    <script>
        // The svg
        const svg = d3.select("#USA"),
            width = +svg.attr("width"),
            height = +svg.attr("height");

        svg.append("g")
            .attr("id", "states")
        svg.append("g")
            .attr("id", "capitals")
        svg.append("g")
            .attr("id", "wind-farms")

        // add a title to the svg map
        svg.append("text")
            .attr("x", 0)
            .attr("y", 170)
            .attr("class", "title")
            .attr("font-style", "sans-serif")
            .attr("font-size", "20px")
            .text("Wind Turbine Farms in the United States");

        // Map and projection. Try:  d3.geoAiry() / d3.geoAitoff() / d3.geoArmadillo() / d3.geoAugust() / d3.geoAzimuthalEqualArea() / d3.geoAzimuthalEquidistant() and more
        let projection = d3.geoAlbersUsa()
            .scale(1000)
            .translate([width / 2, height / 2])

        // Append Div for tooltip to SVG
        var div = d3.select("#Origin")
            .append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);
        
        var color = d3.scaleLinear()
            .range(["#7fcdbb", "#2c7fb8"]);

        var legendText = ["State Capital", "Wind Turbine Farms"];

        // Load external data and boot
        d3.json("test1.geojson").then(function (data) {

            // Draw the map
            svg.select("#states")
                .selectAll("path")
                .data(data.features)
                .join("path")
                .attr("fill", "#eaf7a1")
                .attr("d", d3.geoPath()
                    .projection(projection)
                )
                .style("stroke", "#636363")
        })

        d3.csv("us-state-capitals.csv").then(function (data) {

            // Draw the capitals
            svg.select("#capitals")
                .selectAll("circle")
                .data(data)
                .enter()
                .append("circle")
                .attr("cx", function (d) {
                    return projection([d.longitude, d.latitude])[0];
                })
                .attr("cy", function (d) {
                    return projection([d.longitude, d.latitude])[1];
                })
                .attr("r", "4")
                .style("fill", "#2c7fb8")

                .on("mouseover", function (event, d) {
                    const [x, y] = d3.pointer(event);
                    div.transition()
                        .duration(200)
                        .style("opacity", .9);
                    div.text(d.description + ", " + d.name)
                        .style("left", (x + 175) + "px")
                        .style("top", (y + 30) + "px");
                })

                // fade out tooltip on mouse out               
                .on("mouseout", function (d) {
                    div.transition()
                        .duration(500)
                        .style("opacity", 0);
                });
        })

        d3.csv("windTurbines.csv").then(function (data) {

            // draw the wind turbines
            svg.select("#wind-farms")
                .selectAll("circle")
                .data(data)
                .enter()
                .append("circle")
                .attr("cx", function (d) {
                    return projection([d.long_DD, d.lat_DD])[0];
                })
                .attr("cy", function (d) {
                    return projection([d.long_DD, d.lat_DD])[1];
                })
                .attr("r", "1.5")
                .style("fill", "#7fcdbb")
        });

        var legend = d3.select("#Origin").append("svg")
            .attr("class", "legend")
            .attr("width", 140)
            .attr("height", 200)
            .selectAll("g")
            .data(color.domain().slice().reverse())
            .enter()
            .append("g")
            .attr("transform", function (d, i) { return "translate(0," + i * 20 + ")"; });

        legend.append("rect")
            .attr("width", 18)
            .attr("height", 18)
            .style("fill", color);

        legend.append("text")
            .data(legendText)
            .attr("x", 24)
            .attr("y", 9)
            .attr("dy", ".35em")
            .text(function (d) { return d; });
    </script>
</body>

</html>